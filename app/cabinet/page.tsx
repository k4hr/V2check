'use client';
import { useEffect, useState } from 'react';
import Link from 'next/link';
type User={id:string;telegramId:string;username?:string|null;firstName?:string|null;lastName?:string|null;photoUrl?:string|null;plan?:string|null;expiresAt?:string|null;};
export default function Cabinet(){ const [user,setUser]=useState<User|null>(null); const [err,setErr]=useState<string|null>(null); const [loading,setLoading]=useState(true); useEffect(()=>{ try{ const tg=(window as any)?.Telegram?.WebApp; tg?.ready?.(); tg?.BackButton?.show?.(); tg?.BackButton?.onClick?.(()=>history.back()); }catch{} const initData=(window as any)?.Telegram?.WebApp?.initData; fetch('/api/auth/verify',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({initData})}).then(r=>r.json()).then(d=>{ if(!d?.ok) throw new Error(d?.error||'Auth failed'); setUser(d.user); }).catch(e=>setErr(e?.message||'Ошибка')).finally(()=>setLoading(false)); },[]); return (<main><div className='safe' style={{maxWidth:560,margin:'0 auto'}}><h1 style={{fontWeight:700,fontSize:22,marginBottom:12,textAlign:'center'}}>Личный кабинет</h1>{loading&&<div className='card'>Вход через Telegram…</div>}{err&&<div className='card' role='alert'>Ошибка: {err}</div>}{user&&(<div className='card'><b>{user.firstName||user.username||'Пользователь'}</b><div className='muted' style={{fontSize:12}}>@{user.username||'unknown'} · ID {user.telegramId}</div></div>)}<div className='card'><h2 style={{margin:'0 0 6px'}}>Статус подписки</h2><div className='muted' style={{marginBottom:8}}>Данные подписки появятся после первой покупки.</div><Link href='/pro' className='btn' style={{display:'inline-block'}}>Оформить или продлить</Link></div></div></main>); }
